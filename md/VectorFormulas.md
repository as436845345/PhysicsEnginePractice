# 二维向量与线段绘制的数学原理解析
本文将解析两个核心代码文件（PEVector.cs、LineSegment.cs）背后的向量数学原理，并梳理所有涉及的向量相关数学公式及应用场景。

## 一、核心概念：二维向量的基础定义
二维向量是具有大小（长度）和方向的二维几何对象，在代码中通过 `X`（x轴分量）和 `Y`（y轴分量）描述，数学表达式为：
$$\vec{v} = (x, y)$$

## 二、向量核心运算公式及解析
### 2.1 向量长度（模）计算
向量的长度（也称为模）是向量从原点到端点的欧几里得距离，公式推导基于勾股定理：
$$|\vec{v}| = \sqrt{x^2 + y^2}$$
**应用场景**：代码中用于向量归一化前的长度计算，是后续归一化、方向向量求解的基础。

### 2.2 向量归一化（单位向量）
归一化是将向量转换为**单位向量**（长度为1）的过程，仅保留方向信息，公式为：
$$\hat{v} = \frac{\vec{v}}{|\vec{v}|} = \left( \frac{x}{|\vec{v}|}, \frac{y}{|\vec{v}|} \right),\quad |\vec{a}| \neq 0$$
其中 $\hat{v}$ 表示单位向量，$|\vec{v}|$ 为原向量的长度。
**应用场景**：线段箭头绘制时，先对方向向量归一化，确保箭头长度不受原线段长度影响。

### 2.3 向量加法
两个二维向量相加，对应分量分别求和，公式为：
$$\vec{v_1} + \vec{v_2} = (x_1 + x_2, y_1 + y_2)$$
**应用场景**：
- 计算线段中点（中心）时，先将起点和终点向量相加；
- 箭头端点偏移计算（如箭头左右翼位置）。

### 2.4 向量减法
两个二维向量相减，对应分量分别求差，公式为：
$$\vec{v_1} - \vec{v_2} = (x_1 - x_2, y_1 - y_2)$$
**应用场景**：
- 求解线段的方向向量（从起点指向终点：$\vec{direction} = \vec{EndPos} - \vec{StartPos}$）；
- 箭头中心位置偏移（箭头中心 = 终点 - 归一化方向向量 × 偏移距离）。

### 2.5 向量数乘（缩放）
向量与标量（实数）相乘，分量分别与标量相乘，公式为：
$$k \cdot \vec{v} = (k \cdot x, k \cdot y)$$
其中 $k$ 为标量（缩放系数）。
**应用场景**：
- 线段中点计算：$\vec{Center} = 0.5 \cdot (\vec{StartPos} + \vec{EndPos})$；
- 箭头偏移距离控制（如箭头翼展长度、箭头中心偏移距离）；
- 法向量缩放（调整箭头左右翼的偏移幅度）。

### 2.6 二维向量的法向量（垂直向量）
对于二维向量 $\vec{v} = (x, y)$，其垂直的法向量有两个：
$$\vec{n_1} = (y, -x), \quad \vec{n_2} = (-y, x)$$
其中 $\vec{n_1}$ 为顺时针旋转90°的法向量，$\vec{n_2}$ 为逆时针旋转90°的法向量（也可表示为 $\vec{n_2} = -1 \cdot \vec{n_1}$）。
**应用场景**：线段箭头左右翼位置计算：
- 左翼翼尖：$\vec{leftEndHeadPos} = \vec{endHeadCenter} + k \cdot \vec{n_1}$；
- 右翼翼尖：$\vec{rightEndHeadPos} = \vec{endHeadCenter} + k \cdot \vec{n_2}$。

## 三、线段绘制的复合公式应用
### 3.1 线段中心（中点）计算
结合向量加法与数乘，公式为：
$$\vec{Center} = 0.5 \cdot (\vec{StartPos} + \vec{EndPos})$$

### 3.2 箭头核心位置计算
1. 求解线段方向向量：$\vec{direction} = \vec{EndPos} - \vec{StartPos}$；
2. 方向向量归一化：$\hat{direction} = \frac{\vec{direction}}{|\vec{direction}|}$；
3. 箭头中心偏移（向线段内侧）：$\vec{endHeadCenter} = \vec{EndPos} - Gap \cdot \hat{direction}$（Gap为偏移距离）；
4. 箭头左右翼位置：
   - 左翼：$\vec{left} = \vec{endHeadCenter} + Gap \cdot (y_{dir}, -x_{dir})$；
   - 右翼：$\vec{right} = \vec{endHeadCenter} + Gap \cdot (-y_{dir}, x_{dir})$；
   其中 $(x_{dir}, y_{dir})$ 是归一化后的方向向量分量。

## 四、总结
上述公式覆盖了二维向量的核心运算（长度、加减、数乘、归一化、法向量），并落地到线段绘制（中点、箭头）的实际场景中。所有运算均基于二维笛卡尔坐标系的向量基本性质，核心逻辑是通过向量运算实现几何位置的精准计算，是计算机图形学中二维图形绘制的基础应用。